<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>р╣Ар╕ер╕╖р╕нр╕Бр╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣Ир╕Др╕│</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main>
    <h2>ЁЯОп р╣Ар╕ер╕╖р╕нр╕Бр╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣Ир╕Др╕│</h2>
    <div id="categories">
      <button onclick="selectCategory('р╕Бр╕▓р╕гр╣Мр╕Хр╕╣р╕Щ')">ЁЯУ║ р╕Бр╕▓р╕гр╣Мр╕Хр╕╣р╕Щ</button>
      <button onclick="selectCategory('р╕Фр╕▓р╕гр╕▓')">ЁЯОм р╕Фр╕▓р╕гр╕▓</button>
      <button onclick="selectCategory('р╕Ыр╕гр╕░р╣Ар╕Чр╕и')">ЁЯМН р╕Ыр╕гр╕░р╣Ар╕Чр╕и</button>
      <button onclick="selectCategory('р╕кр╕▒р╕Хр╕зр╣М')">ЁЯжБ р╕кр╕▒р╕Хр╕зр╣М</button>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAc5HEG0fi54dSNOp3mpCnvG5cFQ0TyDCc",
        authDomain: "whoami-91c56.firebaseapp.com",
        databaseURL: "https://whoami-91c56-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "whoami-91c56",
        storageBucket: "whoami-91c56.firebasestorage.app",
        messagingSenderId: "415219915433",
        appId: "1:415219915433:web:9d7f4328d898a9bcb967b8",
        measurementId: "G-R5B47J3D19"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const roomCode = localStorage.getItem("roomCode");

    window.selectCategory = function(category) {
      const words = {
        "р╕Бр╕▓р╕гр╣Мр╕Хр╕╣р╕Щ": ["р╣Вр╕Фр╕гр╕▓р╣Ар╕нр╕бр╕нр╕Щ", "р╕Лр╕┤р╕Щр╣Ар╕Фр╕нр╣Ар╕гр╕ер╕ер╣Ир╕▓", "р╕кр╕Юр╕▒р╕Щр╕Ир╣Мр╕Ър╣Зр╕нр╕Ъ"],
        "р╕Фр╕▓р╕гр╕▓": ["р╣Гр╕лр╕бр╣И р╕Фр╕▓р╕зр╕┤р╕Бр╕▓", "р╣Ар╕зр╕╡р╕вр╕гр╣М р╕ир╕╕р╕Бр╕ер╕зр╕▒р╕Тр╕Щр╣М", "р╕Нр╕▓р╕Нр╣Ир╕▓"],
        "р╕Ыр╕гр╕░р╣Ар╕Чр╕и": ["р╕Нр╕╡р╣Ир╕Ыр╕╕р╣Ир╕Щ", "р╕Эр╕гр╕▒р╣Ир╕Зр╣Ар╕ир╕к", "р╕нр╕╡р╕вр╕┤р╕Ыр╕Хр╣М"],
        "р╕кр╕▒р╕Хр╕зр╣М": ["р╕кр╕┤р╕Зр╣Вр╕Х", "р╕Кр╣Йр╕▓р╕З", "р╣Бр╕Юр╕Щр╕Фр╣Йр╕▓"]
      };

      // р╕кр╕╕р╣Ир╕бр╕Др╕│р╣Гр╕лр╣Йр╕Ьр╕╣р╣Йр╣Ар╕ер╣Ир╕Щр╣Бр╕Хр╣Ир╕ер╕░р╕Др╕Щ р╕вр╕Бр╣Ар╕зр╣Йр╕Щр╕Хр╕▒р╕зр╣Ар╕нр╕З
      get(ref(db, `rooms/${roomCode}/players`)).then(snapshot => {
        const data = snapshot.val();
        const playerKeys = Object.keys(data);
        const randomWords = shuffle(words[category]);

        playerKeys.forEach((key, index) => {
          const word = randomWords[index % randomWords.length];
          set(ref(db, `rooms/${roomCode}/words/${key}`), word);
        });

        // р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕лр╕бр╕зр╕Фр╕Чр╕╡р╣Ир╣Ар╕ер╕╖р╕нр╕Бр╕Фр╣Йр╕зр╕в
        set(ref(db, `rooms/${roomCode}/category`), category);

        window.location.href = "word.html";
      });
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }
  </script>
</body>
</html>
